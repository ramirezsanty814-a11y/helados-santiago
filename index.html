<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Helados Santiago</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#fff}
header{text-align:center;padding:30px;border-bottom:4px solid #8fd3f4;position:relative}
header img{max-width:220px}
#btnCarrito{position:absolute;top:20px;right:20px;background:#009ee3;color:#fff;padding:10px 16px;border-radius:30px;cursor:pointer}
section{max-width:1100px;margin:auto;padding:40px 20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:25px}
.card{background:#fff7e6;border-radius:18px;padding:18px;text-align:center;box-shadow:0 6px 15px rgba(0,0,0,.15)}
.card img{width:100%;border-radius:12px}
button{background:#25d366;color:#fff;border:none;padding:10px;border-radius:10px;margin:5px;cursor:pointer}
#carrito{position:fixed;top:0;right:-340px;width:320px;height:100%;background:#fff;border-left:4px solid #8fd3f4;padding:20px;transition:.3s}
#carrito.activo{right:0}
.finalizar{background:#009ee3;color:#fff;padding:12px;border-radius:10px;text-align:center;margin-top:10px;cursor:pointer}
footer{text-align:center;padding:30px;background:#8fd3f4;color:#fff}
</style>
</head>
<body>

<header>
<img src="logo.png">
<div id="btnCarrito" onclick="toggleCarrito()">ðŸ›’ Carrito</div>
</header>

<section>
<h2>Potes Â½ kg â€“ $5.000</h2>
<div class="grid">
<div class="card">
<img src="potes_medio_kilo.jpg">
<button onclick="add('Pote Banana Split',5000)">Banana Split</button>
<button onclick="add('Pote Chocolate',5000)">Chocolate</button>
</div>
</div>
</section>

<div id="carrito">
<h3>Tu carrito</h3>
<div id="items"></div>
<p>Total: $<span id="total">0</span></p>
<div class="finalizar" onclick="finalizarPedido()">Finalizar pedido</div>
</div>

<footer>
Villa La Florida Â· WhatsApp 11 2308-3778
</footer>

<script>
let cart={};

function toggleCarrito(){
 document.getElementById('carrito').classList.toggle('activo');
}

function add(nombre,precio){
 if(!cart[nombre]) cart[nombre]={precio,qty:0};
 cart[nombre].qty++;
 render();
}

function render(){
 let itemsDiv=document.getElementById('items');
 let total=0;
 itemsDiv.innerHTML='';
 for(let p in cart){
   itemsDiv.innerHTML+=`${p} x${cart[p].qty}<br>`;
   total+=cart[p].precio*cart[p].qty;
 }
 document.getElementById('total').innerText=total;
}

async function finalizarPedido(){
 const items=[];
 for(let p in cart){
   items.push({nombre:p,precio:cart[p].precio,qty:cart[p].qty});
 }
 const res = await fetch('/.netlify/functions/crear-preferencia',{
   method:'POST',
   headers:{'Content-Type':'application/json'},
   body:JSON.stringify({items})
 });
 const data = await res.json();
 if(data.init_point){
   window.location.href = data.init_point;
 }else{
   alert('Error al crear el pago');
 }
}
</script>

</body>
</html>
